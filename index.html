<html>
  <head>
    <title>CDI agora</title>

    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link rel="shortcut icon" type="image/png" href="favicon.png"/>

    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300italic,700,700italic">
    <link rel="stylesheet" href="https://cdn.rawgit.com/necolas/normalize.css/master/normalize.css">
    <link rel="stylesheet" href="https://cdn.rawgit.com/milligram/milligram/master/dist/milligram.min.css">

    <link rel="stylesheet" href="cdi-agora.css">
    <script src="classes.js"></script>

    <script>
      function yearToMonth(rate) {
        return 100 * (Math.pow(rate / 100 + 1, 1/12.0) - 1);
      }

      function formatPct(num) {
        return (Math.round(num * 1e3) / 1e3).toLocaleString('pt-BR') + " %";
      }

      function fillPage(yearlyCDI, monthlyCDI, updatedAt) {
        document.getElementById("yearly-cdi").innerHTML = formatPct(yearlyCDI);
        document.getElementById("monthly-cdi").innerHTML = formatPct(monthlyCDI);
        document.getElementById("updated-at").innerHTML = updatedAt;
      }

      function showMainPanel() {
        var mainPanel = document.getElementById("main-panel");
        removeClass(mainPanel, 'faded');
        addClass(mainPanel, 'fadein');
      }

      b3_request = new XMLHttpRequest();
      b3_request.onreadystatechange = function() {
        if (this.readyState == 4 && this.status == 200) {
          var json = JSON.parse(this.responseText);
          var yearlyCDI = parseFloat(json.taxa.replace(',', '.'));
          var monthlyCDI = yearToMonth(yearlyCDI);
          var updatedAt = json.dataTaxa;

          fillPage(yearlyCDI, monthlyCDI, updatedAt);
          showMainPanel();
        }
      };
      b3_request.open("GET", "https://www2.cetip.com.br/ConsultarTaxaDi/ConsultarTaxaDICetip.aspx", true);
      b3_request.send();
    </script>
  </head>
  <body>
    <div class="full-frame">
      <div id="main-panel" class="main-panel faded">
        <span>CDI agora:</span>
        <h1 class="blue" id="yearly-cdi"></h1>
        <span>Por mÃªs:</span>
        <h2 class="blue" id="monthly-cdi"></h2>
        <p>em <span id="updated-at"></span></p>
      </div>
    </div>
  </body>
</html>
